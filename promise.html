<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Quiz JS : Promises et async/await + ex sup</title>
<style>
  body { font-family: sans-serif; padding: 20px; background: #fafafa; }
  section { margin-bottom: 30px; padding: 15px; background: #fff; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
  pre { background: #f0f0f0; padding: 10px; border-radius: 5px; overflow-x: auto; }
  input { width: 250px; padding: 5px; }
  button { margin-left: 10px; padding: 5px 10px; cursor: pointer; }
  .correct { color: green; display: block; margin-top: 5px; }
  .wrong { color: red; display: block; margin-top: 5px; }
  h2 { margin-top: 0; }

  /* Menu de navigation */
  .nav-menu {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    padding: 15px 25px;
    margin-bottom: 30px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    position: sticky;
    top: 20px;
    z-index: 100;
  }

  .nav-menu h3 {
    margin: 0 0 15px 0;
    color: #2c3e50;
    font-size: 1.1rem;
    text-align: center;
  }

  .nav-links {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
  }

  .nav-links a {
    display: inline-block;
    padding: 8px 16px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    text-decoration: none;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.3s ease;
    border: 2px solid transparent;
  }

  .nav-links a:hover {
    background: linear-gradient(135deg, #5a6fd8, #6a4190);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  }

  .nav-links a.current {
    background: linear-gradient(135deg, #27ae60, #2ecc71);
    border-color: #27ae60;
  }

  @media (max-width: 768px) {
    .nav-links {
      flex-direction: column;
      align-items: center;
    }
    
    .nav-links a {
      width: 100%;
      text-align: center;
      max-width: 200px;
    }
  }
</style>
</head>
<body>

<nav class="nav-menu">
  <h3>üìö Navigation</h3>
  <div class="nav-links">
    <a href="index.html">üè† Accueil</a>
    <a href="promise.html" class="current">‚ö° Promises</a>
    <a href="scope.html">üîç Scope & Hoisting</a>
    <a href="this.html">üéØ This & Closures</a>
    <a href="side.html">üîÑ Side Effects</a>
    <a href="wcag.html">‚ôø Accessibilit√©</a>
  </div>
</nav>

<h1>Quiz JS : Promises et async/await</h1>
<p>Compl√®te ce que la console afficherait pour chaque code et clique sur "Valider".</p>

<div id="quizContainer"></div>

<script>
const quizData = [
  // ===== D√âBUTANT =====
  {
    titre: "1Ô∏è‚É£ Promise simple resolve",
    code: `const p = new Promise((resolve, reject) => { 
  resolve('OK'); 
});
p.then(console.log);`,
    reponse: ["ok"],
    explication: "Une promise r√©solue avec 'OK' : then r√©cup√®re la valeur et l'affiche."
  },
  
  {
    titre: "2Ô∏è‚É£ Promise simple reject",
    code: `const p = new Promise((resolve, reject) => { 
  reject('Erreur'); 
});
p.catch(console.log);`,
    reponse: ["erreur"],
    explication: "Une promise rejet√©e : catch r√©cup√®re l'erreur et l'affiche."
  },
  
  {
    titre: "3Ô∏è‚É£ Cha√Ænage then",
    code: `Promise.resolve(1)
  .then(x => x + 1)
  .then(console.log);`,
    reponse: ["2"],
    explication: "La premi√®re then ajoute 1 √† 1, la deuxi√®me affiche 2."
  },
  
  {
    titre: "4Ô∏è‚É£ Cha√Ænage then avec erreur",
    code: `Promise.resolve(1)
  .then(x => { 
    throw 'Erreur'; 
  })
  .then(x => x + 1)
  .catch(console.log);`,
    reponse: ["erreur"],
    explication: "L'erreur lev√©e interrompt le chain, catch r√©cup√®re 'Erreur'."
  },

  // ===== ASYNC / AWAIT =====
  {
    titre: "5Ô∏è‚É£ Async / await simple",
    code: `async function f() { 
  return 42; 
}
f().then(console.log);`,
    reponse: ["42"],
    explication: "Une fonction async retourne une promise r√©solue avec 42."
  },
  
  {
    titre: "6Ô∏è‚É£ Await valeur promise",
    code: `async function f() { 
  let x = await Promise.resolve(10); 
  console.log(x); 
}
f();`,
    reponse: ["10"],
    explication: "await attend la r√©solution de la promise et affiche 10."
  },
  
  {
    titre: "7Ô∏è‚É£ Async / await avec try/catch",
    code: `async function f() { 
  try { 
    await Promise.reject('Oops'); 
  } catch(e) { 
    console.log(e); 
  } 
}
f();`,
    reponse: ["oops"],
    explication: "La promise est rejet√©e, le catch r√©cup√®re l'erreur et l'affiche."
  },

  // ===== S√âQUENTIEL VS PARALL√àLE =====
  {
    titre: "8Ô∏è‚É£ Ex√©cution s√©quentielle",
    code: `async function f() { 
  let a = await Promise.resolve(1); 
  let b = await Promise.resolve(2); 
  console.log(a, b); 
}
f();`,
    reponse: ["1 2"],
    explication: "Les await successifs s'ex√©cutent s√©quentiellement, affichant 1 puis 2."
  },
  
  {
    titre: "9Ô∏è‚É£ Ex√©cution parall√®le avec Promise.all",
    code: `Promise.all([
  Promise.resolve(1), 
  Promise.resolve(2)
]).then(console.log);`,
    reponse: ["1,2"],
    explication: "Promise.all r√©sout toutes les promises en parall√®le et retourne un tableau des r√©sultats."
  },

  // ===== INTERACTIONS AVEC SETTIMEOUT =====
  {
    titre: "üîü Promise + setTimeout",
    code: `new Promise(resolve => 
  setTimeout(() => resolve('ok'), 0)
).then(console.log);
console.log('done');`,
    reponse: ["done","ok"],
    explication: "setTimeout d√©cal√©, 'done' s'affiche avant la promise r√©solue."
  },
  
  {
    titre: "1Ô∏è‚É£1Ô∏è‚É£ Async / await + setTimeout",
    code: `async function f() { 
  let x = await new Promise(resolve => 
    setTimeout(() => resolve('ok'), 0)
  ); 
  console.log(x); 
}
console.log('start'); 
f();`,
    reponse: ["start","ok"],
    explication: "'start' s'affiche d'abord, await attend la resolution de la promise."
  },

  // ===== EXPERT =====
  {
    titre: "1Ô∏è‚É£2Ô∏è‚É£ Promise.race",
    code: `Promise.race([
  Promise.resolve('A'), 
  new Promise(resolve => 
    setTimeout(() => resolve('B'), 10)
  )
]).then(console.log);`,
    reponse: ["a"],
    explication: "Promise.race prend la premi√®re promise r√©solue : 'A'."
  },
  
  {
    titre: "1Ô∏è‚É£3Ô∏è‚É£ Promise.allSettled",
    code: `Promise.allSettled([
  Promise.resolve('ok'), 
  Promise.reject('erreur')
]).then(console.log);`,
    reponse: ["ok","erreur"],
    explication: "allSettled retourne le r√©sultat de toutes les promises, m√™me rejet√©es."
  },
  
  {
    titre: "1Ô∏è‚É£4Ô∏è‚É£ Async / await + erreur non catch√©e",
    code: `async function f() { 
  await Promise.reject('Oops'); 
}
f().catch(console.log);`,
    reponse: ["oops"],
    explication: "La promise rejet√©e est catch√©e par f().catch, affichant 'Oops'."
  },
  
  {
    titre: "1Ô∏è‚É£5Ô∏è‚É£ Cha√Ænage complexe",
    code: `Promise.resolve(1)
  .then(x => x + 1)
  .then(x => { 
    throw 'Erreur'; 
  })
  .catch(e => 'recup')
  .then(console.log);`,
    reponse: ["recup"],
    explication: "Erreur captur√©e par catch, valeur retourn√©e 'recup' affich√©e ensuite."
  }
];

// M√©langer l'ordre des questions
function shuffle(array) {
  return array.sort(() => Math.random() - 0.5);
}

const container = document.getElementById('quizContainer');
const quizShuffled = shuffle(quizData);

// G√©n√©rer les exercices
quizShuffled.forEach((q, index) => {
  const section = document.createElement('section');
  section.innerHTML = `
    <h2>${q.titre}</h2>
    <pre>${q.code}</pre>
    <label>Que va afficher la console ? (s√©parer plusieurs valeurs par un espace ou une virgule) </label>
    <input type="text" id="input${index}">
    <button id="btn${index}">Valider</button>
    <span id="result${index}"></span>
  `;
  container.appendChild(section);

  document.getElementById(`btn${index}`).addEventListener('click', () => {
    let rep = document.getElementById(`input${index}`).value.trim().toLowerCase();
    rep = rep.replace(/\s*,\s*/g," ").replace(/\s+/g," ").split(" "); // normalisation

    const correct = q.reponse.map(s => s.toLowerCase());
    const resultEl = document.getElementById(`result${index}`);

    let correctFlag = correct.length === rep.length && rep.every(r => correct.includes(r));

    if(correctFlag) {
      resultEl.innerHTML = `‚úÖ Correct !<br>Explication : ${q.explication}`;
      resultEl.className = "correct";
    } else {
      resultEl.innerHTML = `‚ùå Faux<br>Ta r√©ponse : ${document.getElementById(`input${index}`).value}<br>R√©ponse correcte : ${q.reponse.join(", ")}<br>Explication : ${q.explication}`;
      resultEl.className = "wrong";
    }
  });
});
</script>

<!-- ===== EXERCICES COMPL√âMENTAIRES ===== -->
<div id="quizComplementaire"></div>

<script>
const quizComplementaire = [
  // ===== Microtasks vs Macrotasks =====
  {
    titre: "1Ô∏è‚É£6Ô∏è‚É£ Microtasks vs Macrotasks explicite",
    code: `console.log('start');
setTimeout(() => console.log('macrotask'), 0);
Promise.resolve().then(() => console.log('microtask'));
console.log('end');`,
    reponse: ["start","end","microtask","macrotask"],
    explication: "Les microtasks (Promises) s'ex√©cutent avant les macrotasks (setTimeout), m√™me avec 0 ms."
  },

  // ===== Async / await s√©quentiel =====
  {
    titre: "1Ô∏è‚É£7Ô∏è‚É£ Async/await avec plusieurs Promises",
    code: `async function f() {
  const a = Promise.resolve(1);
  const b = Promise.resolve(2);

  console.log(await a);
  console.log(await b);
}
f();`,
    reponse: ["1","2"],
    explication: "Les await successifs s'ex√©cutent s√©quentiellement, donc 1 puis 2."
  },

  // ===== Promise.any =====
  {
    titre: "1Ô∏è‚É£8Ô∏è‚É£ Promise.any",
    code: `Promise.any([
  Promise.reject('erreur1'),
  Promise.resolve('ok'),
  Promise.reject('erreur2')
]).then(console.log);`,
    reponse: ["ok"],
    explication: "Promise.any renvoie la premi√®re promise r√©ussie."
  },

  // ===== Promise.allSettled avec statut =====
  {
    titre: "1Ô∏è‚É£9Ô∏è‚É£ Promise.allSettled avec statut",
    code: `Promise.allSettled([
  Promise.resolve('A'),
  Promise.reject('B'),
  Promise.resolve('C')
]).then(results => results.map(r => r.status));`,
    reponse: ["fulfilled","rejected","fulfilled"],
    explication: "allSettled retourne un tableau d'objets avec le statut de chaque promise."
  },

  // ===== Erreur non catch√©e =====
  {
    titre: "2Ô∏è‚É£0Ô∏è‚É£ Erreur non catch√©e dans async",
    code: `async function f() {
  await Promise.reject('Oops');
}
f();
console.log('after');`,
    reponse: ["after"],
    explication: "L'erreur n'arr√™te pas le code synchrone, 'after' s'affiche, et un warning pour la promise rejet√©e est g√©n√©r√©."
  },

  // ===== Combinaison microtask + macrotask =====
  {
    titre: "2Ô∏è‚É£1Ô∏è‚É£ Combinaison microtask + macrotask",
    code: `setTimeout(() => console.log('1'), 0);
Promise.resolve().then(() => console.log('2'));
setTimeout(() => console.log('3'), 0);
Promise.resolve().then(() => console.log('4'));`,
    reponse: ["2","4","1","3"],
    explication: "Les microtasks (Promises) s'ex√©cutent avant toutes les macrotasks (setTimeout), m√™me si plusieurs macrotasks sont en file."
  }
];

// G√©n√©rer les exercices compl√©mentaires
const containerComp = document.getElementById('quizComplementaire');

quizComplementaire.forEach((q, index) => {
  const section = document.createElement('section');
  section.innerHTML = `
    <h2>${q.titre}</h2>
    <pre>${q.code}</pre>
    <label>Que va afficher la console ? (s√©parer plusieurs valeurs par un espace ou une virgule) </label>
    <input type="text" id="inputComp${index}">
    <button id="btnComp${index}">Valider</button>
    <span id="resultComp${index}"></span>
  `;
  containerComp.appendChild(section);

  document.getElementById(`btnComp${index}`).addEventListener('click', () => {
    let rep = document.getElementById(`inputComp${index}`).value.trim().toLowerCase();
    rep = rep.replace(/\s*,\s*/g," ").replace(/\s+/g," ").split(" "); // normalisation

    const correct = q.reponse.map(s => s.toLowerCase());
    const resultEl = document.getElementById(`resultComp${index}`);

    let correctFlag = correct.length === rep.length && rep.every(r => correct.includes(r));

    if(correctFlag) {
      resultEl.innerHTML = `‚úÖ Correct !<br>Explication : ${q.explication}`;
      resultEl.className = "correct";
    } else {
      resultEl.innerHTML = `‚ùå Faux<br>Ta r√©ponse : ${document.getElementById(`inputComp${index}`).value}<br>R√©ponse correcte : ${q.reponse.join(", ")}<br>Explication : ${q.explication}`;
      resultEl.className = "wrong";
    }
  });
});
</script>


</body>
</html>
