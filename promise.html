<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Quiz JS : Promises et async/await + ex sup</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>

<header>

  <div id="navigation"></div>

  <h1>Quiz JS : Promises et async/await</h1>
  <p class="lead">Mix QCM (choix unique) + r√©ponses libres. Options m√©lang√©es al√©atoirement. Clique sur "Valider" pour obtenir le feedback.</p>
</header>

<div id="quizContainer"></div>

<script>
const quizData = [
  // ===== D√âBUTANT =====
  {
    id: "promise-1",
    titre: "1Ô∏è‚É£ Promise simple resolve",
    code: `const p = new Promise((resolve, reject) => { 
  resolve('OK'); 
});
p.then(console.log);`,
    reponse: ["ok"],
    explication: "Une promise r√©solue avec 'OK' : then r√©cup√®re la valeur et l'affiche."
  },
  
  {
    id: "promise-2",
    titre: "2Ô∏è‚É£ Promise simple reject",
    code: `const p = new Promise((resolve, reject) => { 
  reject('Erreur'); 
});
p.catch(console.log);`,
    reponse: ["erreur"],
    explication: "Une promise rejet√©e : catch r√©cup√®re l'erreur et l'affiche."
  },
  
  {
    id: "promise-3",
    titre: "3Ô∏è‚É£ Cha√Ænage then",
    code: `Promise.resolve(1)
  .then(x => x + 1)
  .then(console.log);`,
    reponse: ["2"],
    explication: "La premi√®re then ajoute 1 √† 1, la deuxi√®me affiche 2."
  },
  
  {
    id: "promise-4",
    titre: "4Ô∏è‚É£ Cha√Ænage then avec erreur",
    code: `Promise.resolve(1)
  .then(x => { 
    throw 'Erreur'; 
  })
  .then(x => x + 1)
  .catch(console.log);`,
    reponse: ["erreur"],
    explication: "L'erreur lev√©e interrompt le chain, catch r√©cup√®re 'Erreur'."
  },

  // ===== ASYNC / AWAIT =====
  {
    id: "promise-5",
    titre: "5Ô∏è‚É£ Async / await simple",
    code: `async function f() { 
  return 42; 
}
f().then(console.log);`,
    reponse: ["42"],
    explication: "Une fonction async retourne une promise r√©solue avec 42."
  },
  
  {
    id: "promise-6",
    titre: "6Ô∏è‚É£ Await valeur promise",
    code: `async function f() { 
  let x = await Promise.resolve(10); 
  console.log(x); 
}
f();`,
    reponse: ["10"],
    explication: "await attend la r√©solution de la promise et affiche 10."
  },
  
  {
    id: "promise-7",
    titre: "7Ô∏è‚É£ Async / await avec try/catch",
    code: `async function f() { 
  try { 
    await Promise.reject('Oops'); 
  } catch(e) { 
    console.log(e); 
  } 
}
f();`,
    reponse: ["oops"],
    explication: "La promise est rejet√©e, le catch r√©cup√®re l'erreur et l'affiche."
  },

  // ===== S√âQUENTIEL VS PARALL√àLE =====
  {
    id: "promise-8",
    titre: "8Ô∏è‚É£ Ex√©cution s√©quentielle",
    code: `async function f() { 
  let a = await Promise.resolve(1); 
  let b = await Promise.resolve(2); 
  console.log(a, b); 
}
f();`,
    reponse: ["1 2"],
    explication: "Les await successifs s'ex√©cutent s√©quentiellement, affichant 1 puis 2."
  },
  
  {
    id: "promise-9",
    titre: "9Ô∏è‚É£ Ex√©cution parall√®le avec Promise.all",
    code: `Promise.all([
  Promise.resolve(1), 
  Promise.resolve(2)
]).then(console.log);`,
    reponse: ["1,2"],
    explication: "Promise.all r√©sout toutes les promises en parall√®le et retourne un tableau des r√©sultats."
  },

  // ===== INTERACTIONS AVEC SETTIMEOUT =====
  {
    id: "promise-10",
    titre: "üîü Promise + setTimeout",
    code: `new Promise(resolve => 
  setTimeout(() => resolve('ok'), 0)
).then(console.log);
console.log('done');`,
    reponse: ["done","ok"],
    explication: "setTimeout d√©cal√©, 'done' s'affiche avant la promise r√©solue."
  },
  
  {
    id: "promise-11",
    titre: "1Ô∏è‚É£1Ô∏è‚É£ Async / await + setTimeout",
    code: `async function f() { 
  let x = await new Promise(resolve => 
    setTimeout(() => resolve('ok'), 0)
  ); 
  console.log(x); 
}
console.log('start'); 
f();`,
    reponse: ["start","ok"],
    explication: "'start' s'affiche d'abord, await attend la resolution de la promise."
  },

  // ===== EXPERT =====
  {
    id: "promise-12",
    titre: "1Ô∏è‚É£2Ô∏è‚É£ Promise.race",
    code: `Promise.race([
  Promise.resolve('A'), 
  new Promise(resolve => 
    setTimeout(() => resolve('B'), 10)
  )
]).then(console.log);`,
    reponse: ["a"],
    explication: "Promise.race prend la premi√®re promise r√©solue : 'A'."
  },
  
  {
    id: "promise-13",
    titre: "1Ô∏è‚É£3Ô∏è‚É£ Promise.allSettled",
    code: `Promise.allSettled([
  Promise.resolve('ok'), 
  Promise.reject('erreur')
]).then(console.log);`,
    reponse: ["ok","erreur"],
    explication: "allSettled retourne le r√©sultat de toutes les promises, m√™me rejet√©es."
  },
  
  {
    id: "promise-14",
    titre: "1Ô∏è‚É£4Ô∏è‚É£ Async / await + erreur non catch√©e",
    code: `async function f() { 
  await Promise.reject('Oops'); 
}
f().catch(console.log);`,
    reponse: ["oops"],
    explication: "La promise rejet√©e est catch√©e par f().catch, affichant 'Oops'."
  },
  
  {
    id: "promise-15",
    titre: "1Ô∏è‚É£5Ô∏è‚É£ Cha√Ænage complexe",
    code: `Promise.resolve(1)
  .then(x => x + 1)
  .then(x => { 
    throw 'Erreur'; 
  })
  .catch(e => 'recup')
  .then(console.log);`,
    reponse: ["recup"],
    explication: "Erreur captur√©e par catch, valeur retourn√©e 'recup' affich√©e ensuite."
  },

  // ===== EXERCICES COMPL√âMENTAIRES =====
  // ===== Microtasks vs Macrotasks =====
  {
    id: "promise-16",
    titre: "1Ô∏è‚É£6Ô∏è‚É£ Microtasks vs Macrotasks explicite",
    code: `console.log('start');
setTimeout(() => console.log('macrotask'), 0);
Promise.resolve().then(() => console.log('microtask'));
console.log('end');`,
    reponse: ["start","end","microtask","macrotask"],
    explication: "Les microtasks (Promises) s'ex√©cutent avant les macrotasks (setTimeout), m√™me avec 0 ms."
  },

  // ===== Async / await s√©quentiel =====
  {
    id: "promise-17",
    titre: "1Ô∏è‚É£7Ô∏è‚É£ Async/await avec plusieurs Promises",
    code: `async function f() {
  const a = Promise.resolve(1);
  const b = Promise.resolve(2);

  console.log(await a);
  console.log(await b);
}
f();`,
    reponse: ["1","2"],
    explication: "Les await successifs s'ex√©cutent s√©quentiellement, donc 1 puis 2."
  },

  // ===== Promise.any =====
  {
    id: "promise-18",
    titre: "1Ô∏è‚É£8Ô∏è‚É£ Promise.any",
    code: `Promise.any([
  Promise.reject('erreur1'),
  Promise.resolve('ok'),
  Promise.reject('erreur2')
]).then(console.log);`,
    reponse: ["ok"],
    explication: "Promise.any renvoie la premi√®re promise r√©ussie."
  },

  // ===== Promise.allSettled avec statut =====
  {
    id: "promise-19",
    titre: "1Ô∏è‚É£9Ô∏è‚É£ Promise.allSettled avec statut",
    code: `Promise.allSettled([
  Promise.resolve('A'),
  Promise.reject('B'),
  Promise.resolve('C')
]).then(results => results.map(r => r.status));`,
    reponse: ["fulfilled","rejected","fulfilled"],
    explication: "allSettled retourne un tableau d'objets avec le statut de chaque promise."
  },

  // ===== Erreur non catch√©e =====
  {
    id: "promise-20",
    titre: "2Ô∏è‚É£0Ô∏è‚É£ Erreur non catch√©e dans async",
    code: `async function f() {
  await Promise.reject('Oops');
}
f();
console.log('after');`,
    reponse: ["after"],
    explication: "L'erreur n'arr√™te pas le code synchrone, 'after' s'affiche, et un warning pour la promise rejet√©e est g√©n√©r√©."
  },

  // ===== Combinaison microtask + macrotask =====
  {
    id: "promise-21",
    titre: "2Ô∏è‚É£1Ô∏è‚É£ Combinaison microtask + macrotask",
    code: `setTimeout(() => console.log('1'), 0);
Promise.resolve().then(() => console.log('2'));
setTimeout(() => console.log('3'), 0);
Promise.resolve().then(() => console.log('4'));`,
    reponse: ["2","4","1","3"],
    explication: "Les microtasks (Promises) s'ex√©cutent avant toutes les macrotasks (setTimeout), m√™me si plusieurs macrotasks sont en file."
  }
];

</script>

<script src="cookie-manager.js"></script>
<script src="quiz-common.js"></script>
<script>
// Initialiser le quiz avec les fonctions communes
const quiz = new QuizManager('quizContainer', quizData, {
    pageId: 'promise' // ID unique pour cette page
});
</script>


<script src="navigation.js"></script>
<script>
  // Initialiser la navigation pour la page Promises
  createNavigation('promise');
</script>

</body>
</html>
